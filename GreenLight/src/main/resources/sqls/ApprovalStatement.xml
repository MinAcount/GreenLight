<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.green.light.model.mapper.ApprovalDaoImpl">
<resultMap type="com.green.light.vo.EmployeeVo" id="EmployeeVoMap">
	<result property="id" column="ID"/>
	<result property="name" column="NAME"/>
	<result property="deptno" column="DEPTNO"/>
	<result property="position" column="POSITION"/>
	<result property="spot" column="SPOT"/>
	<collection property="deptVo" resultMap="DepartmentVoMap"/>
	<collection property="comVo" resultMap="CommonVoMap"/>
</resultMap>

<resultMap type="com.green.light.vo.DepartmentVo" id="DepartmentVoMap">
	<result property="deptno" column="DEPTNO"/>
</resultMap>

<resultMap type="com.green.light.vo.CommonVo" id="CommonVoMap">
	<result property="code_name" column="CODE_NAME"/>
	<result property="code" column="CODE"/>
	<result property="type" column="TYPE"/>
</resultMap>

<!-- 자동결재선 기안자의 부서장 조회 selectDrafterDeptMgr -->
<select id="selectDrafterDeptMgr" resultMap="EmployeeVoMap">
SELECT E2.ID AS ID, E2.NAME AS NAME, C.CODE_NAME AS CODE_NAME
	FROM EMPLOYEE E
	JOIN DEPARTMENT D ON E.DEPTNO = D.DEPTNO 
	JOIN EMPLOYEE E2 ON D.DEPT_MGR = E2.ID 
	JOIN COMMON C ON C.CODE = E2.SPOT AND C."TYPE" = '직위'
	WHERE E.ID = #{id}
</select>

<!-- 자동결재선 부서별 부서장 조회 selectDeptMgrByDept -->
<select id="selectDeptMgrByDept" resultMap="EmployeeVoMap">
SELECT E.ID AS ID, E.NAME AS NAME, C.CODE_NAME AS CODE_NAME
	FROM EMPLOYEE E
	JOIN DEPARTMENT D ON E.DEPTNO = D.DEPTNO AND E."POSITION" = '01'
	JOIN COMMON C ON C.CODE = E.SPOT AND C."TYPE" = '직위'
	WHERE E.DEPTNO = #{deptno}
</select>

<!-- 자동결재선 대표이사 조회 selectCEO -->
<select id="selectCEO" resultMap="EmployeeVoMap">
SELECT E.ID AS ID, E.NAME AS NAME, C.CODE_NAME AS CODE_NAME
	FROM EMPLOYEE E
	JOIN COMMON C ON C.CODE = E."POSITION"  AND C."TYPE" = '직책'
	WHERE E."POSITION" = '04'
	AND E.DEPTNO = '00'
</select>
</mapper>
