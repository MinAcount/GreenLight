<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.green.light.model.mapper.DocumentDaoImpl">

	<resultMap type="com.green.light.vo.DocumentVo" id="DocumentVo">
		<result property="docno" column="DOCNO"/>
		<result property="writer_id" column="WRITER_ID"/>
		<result property="title" column="TITLE"/>
		<result property="content" column="CONTENT"/>
		<result property="draft_date" column="DRAFT_DATE"/>
		<result property="urgency" column="URGENCY"/>
		<result property="tempno" column="TEMPNO"/>
		<result property="doc_status" column="DOC_STATUS"/>
		<collection property="commVo" resultMap="CommonVo"/>
		<collection property="deptVo" resultMap="DepartmentVo"/>
		<collection property="headVo" resultMap="HeadquartersVo"/>
		<collection property="empVo" resultMap="EmployeeVo"/>
		<collection property="apprVo" resultMap="ApprovalVo"/>
		<collection property="fileVo" resultMap="FileStorageVo"/>
	</resultMap>
	<resultMap type="com.green.light.vo.CommonVo" id="CommonVo">
		<result property="type" column="TYPE"/>
		<result property="code_name" column="CODE_NAME"/>
		<result property="code" column="CODE"/>
	</resultMap>
	<resultMap type="com.green.light.vo.DepartmentVo" id="DepartmentVo">
		<result property="deptno" column="DEPTNO"/>
		<result property="dname" column="DNAME"/>
		<result property="dept_mgr" column="DEPT_MGR"/>
		<result property="headno" column="HEADNO"/>
<!-- 		<result property="delflag" column="DELFLAG"/> -->
	</resultMap>
	<resultMap type="com.green.light.vo.HeadquartersVo" id="HeadquartersVo">
		<result property="headno" column="HEADNO"/>
		<result property="hname" column="HNAME"/>
		<result property="head_mgr" column="HEAD_MGR"/>
<!-- 		<result property="delflag" column="DELFLAG"/> -->
	</resultMap>
	<resultMap type="com.green.light.vo.EmployeeVo" id="EmployeeVo">
		<result property="id" column="ID"/>
<!-- 		<result property="name" column="NAME"/> -->
<!-- 		<result property="password" column="PASSWORD"/> -->
<!-- 		<result property="email" column="EMAIL"/> -->
<!-- 		<result property="phone" column="PHONE"/> -->
<!-- 		<result property="birthday" column="BIRTHDAY"/> -->
<!-- 		<result property="gender" column="GENDER"/> -->
<!-- 		<result property="address" column="ADDRESS"/> -->
		<result property="deptno" column="DEPTNO"/>
		<result property="spot" column="SPOT"/>
		<result property="position" column="POSITION"/>
<!-- 		<result property="estatus" column="ESTATUS"/> -->
<!-- 		<result property="join_day" column="JOIN_DAY"/> -->
<!-- 		<result property="exit_day" column="EXIT_DAY"/> -->
<!-- 		<result property="etype" column="ETYPE"/> -->
		<result property="leave" column="LEAVE"/>
<!-- 		<result property="auth" column="AUTH"/> -->
<!-- 		<result property="profile" column="PROFILE"/> -->
	</resultMap>                    
	<resultMap type="com.green.light.vo.Approval" id="ApprovalVo">
		<result property="apprno" column="APPRNO"/>
		<result property="docno" column="DOCNO"/>
		<result property="writer_id" column="WRITER_ID"/>
		<result property="atype" column="ATYPE"/>
		<result property="emp_id" column="EMP_ID"/>
		<result property="appr_status" column="APPR_STATUS"/>
		<result property="orderno" column="ORDERNO"/>
		<result property="appr_date" column="APPR_DATE"/>
		<result property="signature" column="SIGNATURE"/>
		<result property="comment" column="COMMENT"/>
	</resultMap>
	<resultMap type="com.green.light.vo.FileStorageVo" id="FileStorageVo">
		<result property="ref_id" column="REF_ID"/>
		<result property="ftype" column="FTYPE"/>
		<result property="origin_name" column="ORIGIN_NAME"/>
<!-- 		<result property="stored_name" column="STORED_NAME"/> -->
<!-- 		<result property="payload" column="PAYLOAD"/> -->
		<result property="fsize" column="FSIZE"/>
<!-- 		<result property="upload_date" column="UPLOAD_DATE"/> -->
<!-- 		<result property="delflag" column="DELFLAG"/> -->
	</resultMap>
	
	
	
	<!-- 기안문서함 전체조회 getAllDraftDocument -->
	<select id="getAllDraftDocument" resultMap="DocumentVo">
		SELECT d.DOCNO, d.WRITER_ID, d.TITLE, 
       d.DRAFT_DATE, d.URGENCY, 
       c.CODE_NAME, 
       c2.CODE_NAME, 
       (SELECT COUNT(*) FROM FILESTORAGE f2 WHERE REF_ID = d.DOCNO AND FTYPE='01')
		FROM DOCUMENT d 
		JOIN COMMON c ON d.TEMPNO = c.CODE AND c."TYPE" = '문서양식코드'
		JOIN COMMON c2 ON d.DOC_STATUS = c2.CODE AND c2."TYPE" = '기안서상태'
		WHERE d.WRITER_ID = ${id};
	</select>
</mapper>
